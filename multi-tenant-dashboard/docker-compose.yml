services:
  clickhouse:
    image: clickhouse/clickhouse-server:24.1
    ports:
      - "8123:8123"
    volumes:
      - ./seed:/docker-entrypoint-initdb.d
    environment:
      CLICKHOUSE_USER: default
      CLICKHOUSE_PASSWORD: demo
  seed:
    image: clickhouse/clickhouse-server:24.1
    depends_on:
      - clickhouse
    volumes:
      - ./seed:/seed:ro
    entrypoint: ["/bin/sh", "-c"]
    command:
      - |
        until clickhouse-client --host clickhouse --user default --password demo --query "SELECT 1" >/dev/null 2>&1; do
          sleep 1;
        done;
        clickhouse-client --host clickhouse --user default --password demo --multiquery --queries-file /seed/init.sql
    restart: "no"
